var array_get=function(e,t,a){"use strict";"undefined"==typeof a&&(a=null);var l;try{l=e[t]}catch(i){l=a}return null===l&&(l=a),l},stringToSlug=function(e,t){"use strict";return t=t||"-",e.toString().toLowerCase().replace(/á|à|ả|ạ|ã|ă|ắ|ằ|ẳ|ẵ|ặ|â|ấ|ầ|ẩ|ẫ|ậ/gi,"a").replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ/gi,"e").replace(/i|í|ì|ỉ|ĩ|ị/gi,"i").replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ/gi,"o").replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự/gi,"u").replace(/ý|ỳ|ỷ|ỹ|ỵ/gi,"y").replace(/đ/gi,"d").replace(/\s+/g,t).replace(/[^\w\-]+/g,"").replace(/\-\-+/g,t).replace(/^-+/,"").replace(/-+$/,"")},ManageCustomFields=function(){var e=$("body"),t=$("#rules_group_template").html(),a=function(){var a=$.parseJSON($("#custom_fields_rules").val()),l=$(t),i=$(".line-group-container");e.on("click",".location-add-rule",function(e){e.preventDefault();var t=$(this),a=l.clone();if(t.hasClass("location-add-rule-and"))t.closest(".line-group").append(a);else{var n=$('<div class="line-group"></div>');n.append(a),i.append(n)}a.find(".rule-a").trigger("change")}),e.on("change",".rule-a",function(e){e.preventDefault();var t=$(this),a=t.closest(".rule-line");a.find(".rules-b-group select").addClass("hidden"),a.find('.rules-b-group select[data-rel="'+t.val()+'"]').removeClass("hidden")}),e.on("click",".remove-rule-line",function(e){e.preventDefault();var t=$(this),a=t.closest(".rule-line"),l=t.closest(".line-group");l.find(".rule-line").length<2?l.remove():a.remove()}),a.length<1?$(".location-add-rule").trigger("click"):a.forEach(function(e,t){var a=$('<div class="line-group"></div>');e.forEach(function(e,t){var i=l.clone();i.find(".rule-a").val(e.name),i.find(".rule-type").val(e.type),i.find('.rule-b:not([data-rel="'+e.name+'"])').addClass("hidden"),i.find('.rule-b[data-rel="'+e.name+'"]').val(e.value),a.append(i)}),i.append(a)})},l=function(){var t=0,a=$.parseJSON($("#custom_fields").val()),l=[],i=$("#_new-field-source_template").html(),n={repeater:$("#_options-repeater_template").html(),defaultValue:$("#_options-defaultvalue_template").html(),defaultValueTextarea:$("#_options-defaultvaluetextarea_template").html(),placeholderText:$("#_options-placeholdertext_template").html(),wysiwygToolbar:$("#_options-wysiwygtoolbar_template").html(),selectChoices:$("#_options-selectchoices_template").html(),buttonLabel:$("#_options-buttonlabel_template").html(),rows:$("#_options-rows_template").html()},o=function(e){var t="";switch(e){case"text":case"email":case"password":case"number":t+=n.defaultValue+n.placeholderText;break;case"image":case"file":return"";case"textarea":t+=n.defaultValueTextarea+n.placeholderText+n.rows;break;case"wysiwyg":t+=n.defaultValueTextarea+n.wysiwygToolbar;break;case"select":t+=n.selectChoices+n.defaultValue;break;case"checkbox":t+=n.selectChoices;break;case"radio":t+=n.selectChoices;break;case"repeater":t+=n.repeater+n.buttonLabel}return t},r=function(e){e.each(function(e,t){var a=$(this),l=e+1;a.attr("data-position",l)})},s=function(e,t){e.attr("data-position",t||e.index()+1)},u=function(e){return i.replace(/___options___/gi,o(e||"text"))};e.on("click",".show-item-details",function(e){e.preventDefault();var t=$(this).closest("li");$(this).toggleClass("active"),t.toggleClass("active")}),e.on("click",".btn-close-field",function(e){e.preventDefault();var t=$(this).closest("li");t.toggleClass("active"),t.find("> .field-column .show-item-details").toggleClass("active")}),e.on("click",".btn-add-field",function(e){e.preventDefault();var a=$(this);t++;var l=a.closest(".add-new-field").find("> .sortable-wrapper"),i=$(u());l.append(i),i.find(".line[data-option=title] input[type=text]").focus(),s(i),i.find(".sortable-wrapper").sortable()}),e.on("change",".change-field-type",function(e){e.preventDefault();var t=$(this),a=t.closest(".item-details"),l=a.find("> .options");l.html(o(t.val()))}),e.on("change blur",".line[data-option=slug] input[type=text]",function(e){var t=$(this),a=stringToSlug(t.val(),"_"),l=t.closest(".line");l.closest(".ui-sortable-handle").find("> .field-column .field-slug").text(a),t.val(a)}),e.on("change blur",".line[data-option=type] select",function(e){var t=$(this),a=stringToSlug(t.val(),"_"),l=t.closest(".line");l.closest(".ui-sortable-handle").find("> .field-column .field-type").text(a),t.val(a)}),e.on("change blur",".line[data-option=title] input[type=text]",function(e){var t=$(this),a=t.closest(".line"),l=a.find("~ .line[data-option=slug] input[type=text]"),i=t.val();a.closest(".ui-sortable-handle").find("> .field-column .field-label").text(i),l.val()||l.val(stringToSlug(i,"_")).trigger("change")}),$("#deleted_items").val(""),e.on("click",".btn-remove",function(e){e.preventDefault();var t=$(this).closest(".ui-sortable-handle"),a=t.parent();l.push(t.data("id")),t.animate({top:-60,left:60,opacity:.3},300,function(){t.remove(),r(a.find("> li"))}),$("#deleted_items").val(JSON.stringify(l))});var d=function(e,t){t.sortable(),e.forEach(function(e,a){var l=$(u(e.type||"text"));l.data("id",e.id||0),l.find(".line[data-option=type] select").val(array_get(e,"type","text")),l.find(".line[data-option=title] input").val(array_get(e,"title","")),l.find(".line[data-option=slug] input").val(array_get(e,"slug","")),l.find(".line[data-option=instructions] textarea").val(array_get(e,"instructions","")),l.find(".line[data-option=defaultvalue] input").val(array_get(e.options,"defaultValue","")),l.find(".line[data-option=defaultvaluetextarea] textarea").val(array_get(e.options,"defaultValueTextarea","")),l.find(".line[data-option=placeholdertext] input").val(array_get(e.options,"placeholderText","")),l.find(".line[data-option=wysiwygtoolbar] select").val(array_get(e.options,"wysiwygToolbar","basic")),l.find(".line[data-option=selectchoices] textarea").val(array_get(e.options,"selectChoices","")),l.find(".line[data-option=buttonlabel] input").val(array_get(e.options,"buttonLabel","")),l.find(".line[data-option=rows] input").val(array_get(e.options,"rows","")),l.find(".field-label").html(array_get(e,"title","Text")),l.find(".field-slug").html(array_get(e,"slug","text")),l.find(".field-type").html(array_get(e,"type","text")),l.removeClass("active"),l.attr("data-position",a+1),d(e.items,l.find(".sortable-wrapper")),t.append(l)})};d(a,$(".sortable-wrapper"))},i=function(){return{exportRulesToJson:function(){var e=[];return $(".custom-fields-rules .line-group-container .line-group").each(function(){var t=$(this),a=[];t.find(".rule-line").each(function(e,t){var l=$(this),i={name:l.find(".rule-a").val(),type:l.find(".rule-type").val(),value:l.find(".rule-b:not(.hidden)").val()};a.push(i)}),a.length>0&&e.push(a)}),e},exportFieldsToJson:function(){var e=[],t=function(e,a){e.each(function(e,l){var i={},n=$(this);i.id=n.data("id")||0,i.title=n.find("> .item-details > .line[data-option=title] input[type=text]").val()||null,i.slug=n.find("> .item-details > .line[data-option=slug] input[type=text]").val()||null,i.instructions=n.find("> .item-details > .line[data-option=instructions] textarea").val()||null,i.type=n.find("> .item-details > .line[data-option=type] select").val()||null,i.options={defaultValue:n.find("> .item-details > .options > .line[data-option=defaultvalue] input[type=text]").val()||null,defaultValueTextarea:n.find("> .item-details > .options > .line[data-option=defaultvaluetextarea] textarea").val()||null,placeholderText:n.find("> .item-details > .options > .line[data-option=placeholdertext] input[type=text]").val()||null,wysiwygToolbar:n.find("> .item-details > .options > .line[data-option=wysiwygtoolbar] select").val()||null,selectChoices:n.find("> .item-details > .options > .line[data-option=selectchoices] textarea").val()||null,buttonLabel:n.find("> .item-details > .options > .line[data-option=buttonlabel] input[type=text]").val()||null,rows:n.find("> .item-details > .options > .line[data-option=rows] input[type=number]").val()||null},i.items=[],t(n.find("> .item-details > .options > .line[data-option=repeater] > .col-xs-9 > .add-new-field > .sortable-wrapper > .ui-sortable-handle"),i.items),a.push(i)})};return t($("#custom_field_group_items > .ui-sortable-handle"),e),e}}}();return{init:function(){a(),l(),e.on("submit",".form-update-field-group",function(e){var t=JSON.stringify(i.exportRulesToJson()),a=JSON.stringify(i.exportFieldsToJson());$("#custom_fields_rules").html(t).val(t),$("#custom_fields").html(a).val(a)})}}}();!function(e){e(window).load(function(){ManageCustomFields.init()})}(jQuery);