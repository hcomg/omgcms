!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function a(t){this.$container=t,this.$avatarView=this.$container.find(".avatar-view"),this.$avatar=this.$avatarView.find("img"),this.$avatarModal=this.$container.find("#avatar-modal"),this.$loading=this.$container.find(".loading"),this.$avatarForm=this.$avatarModal.find(".avatar-form"),this.$avatarUpload=this.$avatarForm.find(".avatar-upload"),this.$avatarSrc=this.$avatarForm.find(".avatar-src"),this.$avatarData=this.$avatarForm.find(".avatar-data"),this.$avatarInput=this.$avatarForm.find(".avatar-input"),this.$avatarSave=this.$avatarForm.find(".avatar-save"),this.$avatarWrapper=this.$avatarModal.find(".avatar-wrapper"),this.$avatarPreview=this.$avatarModal.find(".avatar-preview"),this.init()}var i=window.console||{log:t.noop};a.prototype={constructor:a,support:{fileList:!!t('<input type="file">').prop("files"),fileReader:!!window.FileReader,formData:!!window.FormData},init:function(){this.support.datauri=this.support.fileList&&this.support.fileReader,this.support.formData||this.initIframe(),this.initTooltip(),this.initModal(),this.addListener()},addListener:function(){this.$avatarView.on("click",t.proxy(this.click,this)),this.$avatarInput.on("change",t.proxy(this.change,this)),this.$avatarForm.on("submit",t.proxy(this.submit,this))},initTooltip:function(){this.$avatarView.tooltip({placement:"bottom"})},initModal:function(){this.$avatarModal.modal("hide"),this.initPreview()},initPreview:function(){var t=this.$avatar.prop("src");this.$avatarPreview.empty().html('<img src="'+t+'">')},initIframe:function(){var a="avatar-iframe-"+Math.random().toString().replace(".",""),i=t('<iframe name="'+a+'" style="display:none;"></iframe>'),r=!0,s=this;this.$iframe=i,this.$avatarForm.attr("target",a).after(i),this.$iframe.on("load",function(){var t,a,i;try{a=this.contentWindow,i=this.contentDocument,i=i?i:a.document,t=i?i.body.innerText:null}catch(e){}t?s.submitDone(t):r?r=!1:s.submitFail("Image upload failed!"),s.submitEnd()})},click:function(){this.$avatarModal.modal("show")},change:function(){var t,a;this.support.datauri?(t=this.$avatarInput.prop("files"),t.length>0&&(a=t[0],this.isImageFile(a)&&this.read(a))):(a=this.$avatarInput.val(),this.isImageFile(a)&&this.syncUpload())},submit:function(){return this.$avatarSrc.val()||this.$avatarInput.val()?this.support.formData?(this.ajaxUpload(),!1):void 0:(Botble.showNotice("error","Please select image!",Botble.languages.notices_msg.error),!1)},isImageFile:function(t){return t.type?/^image\/\w+$/.test(t.type):/\.(jpg|jpeg|png|gif)$/.test(t)},read:function(t){var a=this,i=new FileReader;i.readAsDataURL(t),i.onload=function(){a.url=this.result,a.startCropper()}},startCropper:function(){var a=this;this.active?this.$img.cropper("replace",this.url):(this.$img=t('<img src="'+this.url+'">'),this.$avatarWrapper.empty().html(this.$img),this.$img.cropper({aspectRatio:1,rotatable:!0,preview:this.$avatarPreview.selector,done:function(t){var i=['{"x":'+t.x,'"y":'+t.y,'"height":'+t.height,'"width":'+t.width+"}"].join();a.$avatarData.val(i)}}),this.active=!0)},stopCropper:function(){this.active&&(this.$img.cropper("destroy"),this.$img.remove(),this.active=!1)},ajaxUpload:function(){var a=this.$avatarForm.attr("action"),r=new FormData(this.$avatarForm[0]),s=this;t.ajax(a,{type:"post",data:r,processData:!1,contentType:!1,beforeSend:function(){s.submitStart()},success:function(t){s.submitDone(t)},error:function(t,a,r){i.log(t.responseJSON),s.submitFail(t.responseJSON,a||r)},complete:function(){s.submitEnd()}})},syncUpload:function(){this.$avatarSave.click()},submitStart:function(){this.$loading.fadeIn(),this.$avatarSave.attr("disabled",!0).text("Saving...")},submitDone:function(a){try{a=t.parseJSON(a)}catch(i){}a&&!a.error?a.result?(this.url=a.result,this.support.datauri||this.uploaded?(this.uploaded=!1,this.cropDone()):(this.uploaded=!0,this.$avatarSrc.val(this.url),this.startCropper()),this.$avatarInput.val(""),Botble.showNotice("success",a.message,Botble.languages.notices_msg.success)):Botble.showNotice("error",a.message,Botble.languages.notices_msg.error):Botble.showNotice("error","Failed to response",Botble.languages.notices_msg.error)},submitFail:function(t){Botble.handleError(t)},submitEnd:function(){this.$loading.fadeOut(),this.$avatarSave.removeAttr("disabled").text("Save")},cropDone:function(){this.$avatarSrc.val(""),this.$avatarData.val(""),this.$avatar.prop("src",this.url),t(".user-menu img").prop("src",this.url),t(".user.dropdown img").prop("src",this.url),this.stopCropper(),this.initModal()}},t(function(){var i=(new a(t(".crop-avatar")),{});i.ui={container:"#pwd-container",verdicts:["<span class='fa fa-exclamation-triangle'></span> Weak","<span class='fa fa-exclamation-triangle'></span> Normal","Medium","<span class='fa fa-thumbs-up'></span> Strong","<span class='fa fa-thumbs-up'></span> Very Strong"],showVerdictsInsideProgressBar:!0,viewports:{progress:".pwstrength_viewport_progress"}},i.common={debug:!0,onLoad:function(){t("#messages").text("Start typing password")}},t(":password").pwstrength(i),t(".pwstrength_viewport_progress").hide(),t(":password").keypress(function(){t(".pwstrength_viewport_progress").fadeIn()}).blur(function(){""==t(this).val()&&t(".pwstrength_viewport_progress").hide()})})});