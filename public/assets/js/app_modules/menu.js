var MenuNestable=function(){return{props:{nestable:$("#nestable")},setDataItem:function(t){t.each(function(t,a){var e=$(a);e.data("id",e.attr("data-id")),e.data("title",e.attr("data-title")),e.data("related-id",e.attr("data-related-id")),e.data("type",e.attr("data-type")),e.data("custom-url",e.attr("data-custom-url")),e.data("class",e.attr("data-class")),e.data("target",e.attr("data-target"))})},updatePositionForSerializedObj:function(t){var a=t;return $.each(a,function(t,a){a.position=t,"undefined"==typeof a.children&&(a.children=[]),MenuNestable.updatePositionForSerializedObj(a.children)}),a},init:function(){var t=parseInt(MenuNestable.props.nestable.attr("data-depth"));t<1&&(t=5),$(".nestable-menu").nestable({group:1,maxDepth:t,expandBtnHTML:"",collapseBtnHTML:""})},handleNestableMenu:function(){function t(t){$(t.target).prev(".widget-heading").find(".narrow-icon").toggleClass("fa-angle-down fa-angle-up")}$(document).on("click",".dd-item .dd3-content a.show-item-details",function(t){t.preventDefault();var a=$(this).parent().parent();$(this).toggleClass("active"),a.toggleClass("active")}),$(document).on("change blur keyup",'.nestable-menu .item-details input[type="text"], .nestable-menu .item-details select',function(t){t.preventDefault();var a=$(this),e=a.closest("li.dd-item");e.attr("data-"+a.attr("name"),a.val()),e.data(a.attr("name"),a.val()),e.find('> .dd3-content .text[data-update="'+a.attr("name")+'"]').text(a.val()),""==a.val().trim()&&e.find('> .dd3-content .text[data-update="'+a.attr("name")+'"]').text(a.attr("data-old")),MenuNestable.setDataItem(MenuNestable.props.nestable.find("> ol.dd-list li.dd-item"))}),$(document).on("click",".box-links-for-menu .btn-add-to-menu",function(t){t.preventDefault();var a=$(this),e=a.parents(".the-box"),l="";if("external_link"==e.attr("id")){var n="custom-link",s=0,i=$("#node-title").val(),d=$("#node-url").val(),o=$("#node-css").val(),c=$("#node-icon").val(),p=$("#target").find("option:selected").val(),r='<label class="pad-bot-5"><span class="text pad-top-5 dis-inline-block" data-update="custom-url">Url</span><input type="text" data-old="'+d+'" value="'+d+'" name="custom-url"></label>';l+='<li data-type="'+n+'" data-related-id="'+s+'" data-title="'+i+'" data-class="'+o+'" data-id="0" data-custom-url="'+d+'" data-icon-font="'+c+'" data-target="'+p+'" class="dd-item dd3-item">',l+='<div class="dd-handle dd3-handle"></div>',l+='<div class="dd3-content">',l+='<span class="text pull-left" data-update="title">'+i+"</span>",l+='<span class="text pull-right">'+n+"</span>",l+='<a href="#" class="show-item-details"><i class="fa fa-angle-down"></i></a>',l+='<div class="clearfix"></div>',l+="</div>",l+='<div class="item-details">',l+='<label class="pad-bot-5">',l+='<span class="text pad-top-5 dis-inline-block" data-update="title">Title</span>',l+='<input type="text" data-old="'+i+'" value="'+i+'" name="title" class="form-control">',l+="</label>",l+=r,l+='<label class="pad-bot-5 dis-inline-block"><span class="text pad-top-5" data-update="icon-font">Icon - font</span><input type="text" name="icon-font" value="'+c+'" data-old="'+c+'" class="form-control"></label>',l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="class">CSS class</span>',l+='<input type="text" data-old="'+o+'" value="'+o+'" name="class" class="form-control">',l+="</label>",l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="target">Target</span>',l+='<div style="width: 228px; display: inline-block"><select name="target" id="target" data-old="'+p+'" class="form-control select-full">',l+='<option value="_self">Open link directly</option>',l+='<option value="_blank" '+("_blank"==p?'selected="selected"':"")+">Open link in new tab</option>",l+="</select></div>",l+="</label>",l+='<div class="text-right">',l+='<a class="btn red btn-remove" href="#">Remove</a>',l+='<a class="btn blue btn-cancel" href="#">Cancel</a>',l+="</div>",l+="</div>",l+='<div class="clearfix"></div>',l+="</li>",e.find('input[type="text"]').val("")}else e.find(".list-item li.active").each(function(t,a){var e=$(a).find("> label"),n=e.attr("data-type"),s=e.attr("data-related-id"),i=e.attr("data-title");l+='<li data-type="'+n+'" data-related-id="'+s+'" data-title="'+i+'" data-id="0" data-target="_self" class="dd-item dd3-item">',l+='<div class="dd-handle dd3-handle"></div>',l+='<div class="dd3-content">',l+='<span class="text pull-left" data-update="title">'+i+"</span>",l+='<span class="text pull-right">'+n+"</span>",l+='<a href="#" class="show-item-details"><i class="fa fa-angle-down"></i></a>',l+='<div class="clearfix"></div>',l+="</div>",l+='<div class="item-details">',l+='<label class="pad-bot-5">',l+='<span class="text pad-top-5 dis-inline-block" data-update="title">Title</span>',l+='<input type="text" data-old="'+i+'" value="'+i+'" name="title" class="form-control">',l+="</label>",l+='<label class="pad-bot-5 dis-inline-block"><span class="text pad-top-5" data-update="icon-font">Icon - font</span><input type="text" name="icon-font" class="form-control"></label>',l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="class">CSS class</span>',l+='<input type="text" name="class" class="form-control">',l+="</label>",l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="target">Target</span>',l+='<div style="width: 228px; display: inline-block"><select name="target" id="target" class="form-control select-full">',l+='<option value="_self">Open link directly</option>',l+='<option value="_blank">Open link in new tab</option>',l+="</select></div>",l+="</label>",l+='<div class="text-right">',l+='<a class="btn red btn-remove" href="#">Remove</a>',l+='<a class="btn blue btn-cancel" href="#">Cancel</a>',l+="</div>",l+="</div>",l+='<div class="clearfix"></div>',l+="</li>"});$(".nestable-menu > ol.dd-list").append(l),$(".nestable-menu").find(".select-full").select2({width:"100%",minimumResultsForSearch:-1}),MenuNestable.setDataItem(MenuNestable.props.nestable.find("> ol.dd-list li.dd-item")),e.find(".list-item li.active").removeClass("active")}),$('.form-save-menu input[name="deleted_nodes"]').val(""),$(document).on("click",".nestable-menu .item-details .btn-remove",function(t){t.preventDefault();var a=$(this),e=a.parents(".item-details").parent(),l=$('.form-save-menu input[name="deleted_nodes"]');l.val(l.val()+" "+e.attr("data-id"));var n=e.find("> .dd-list").html();""!=n&&null!=n&&e.before(n),e.remove()}),$(document).on("click",".nestable-menu .item-details .btn-cancel",function(t){t.preventDefault();var a=$(this),e=a.parents(".item-details").parent();e.find('input[type="text"]').each(function(t,a){$(a).val($(a).attr("data-old"))}),e.find("select").each(function(t,a){$(a).val($(a).val())}),e.find('input[type="text"]').trigger("change"),e.find("select").trigger("change"),e.removeClass("active")}),$(document).on("change",".box-links-for-menu .list-item li .styled",function(){$(this).closest("li").toggleClass("active")}),$(document).on("submit",".form-save-menu",function(){if(MenuNestable.props.nestable.length<1)$("#nestable-output").val("[]");else{var t=MenuNestable.props.nestable.nestable("serialize"),a=MenuNestable.updatePositionForSerializedObj(t);$("#nestable-output").val(JSON.stringify(a))}});var a=$("#accordion");a.on("hidden.bs.collapse",t),a.on("shown.bs.collapse",t),Botble.callScroll($(".list-item"))}}}();$(window).load(function(){MenuNestable.init(),MenuNestable.handleNestableMenu()});