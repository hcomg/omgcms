(function(){"use strict";var e,t,n,a,i,d,l,o,r,u,s,c,f,m,p,h,g,v,k,y,b,N,w,I,S;e=jQuery,k=!1,S=!1,y=null,b=0,N=10,w=100,String.prototype.includes||(String.prototype.includes=function(){return String.prototype.indexOf.apply(this,arguments)!==-1}),"2"===Modernizr._version[0]&&(delete Modernizr.flexbox,Modernizr.addTest("flexbox",Modernizr.testAllProps("flexBasis","1px",!0))),v=function(t){var n,a,i,d,l,o,r,u;n=this.dataItem(t.dropTarget),null!=n&&null!=n.kind&&(i=this.dataItem(t.sourceNode),"k-add"!==t.statusClass&&"add"!==t.statusClass||("page"===n.kind||"category"===i.kind&&"category"===n.kind)&&t.setStatusClass("k-denied"),"category"===i.kind&&t.statusClass.includes("insert")&&(a=this.parent(t.dropTarget),0!==a.length&&t.setStatusClass("k-denied")),d=e(window),l=t.pageY-d.scrollTop(),o=d.height(),r=o*N/100,u=o-r,b=l<r?l-r:l>u?l-u:0,0!==b&&null==y&&I())},I=function(){0===e(".k-drag-clue").length&&(b=0),0===b?y=null:(window.scrollBy(0,b),y=setTimeout(I,w))},i=function(e){var t,n,a,i,d;if(n=this.dataItem(e.node),null!=n)f(e.node,n);else for(a=this.dataSource.data(),t=0,i=a.length;t<i;t++)n=a[t],d=this.findByUid(n.uid),f(d,n)},f=function(t,n){"category"===n.kind&&null!=n.children&&e(t).find(">div .item-count").text(n.items.length)},d=function(e){var t,n,a,i,d,l,o;for(t=null==e.field,o=e.items,n=0,l=o.length;n<l;n++)d=o[n],(t||"icon"===e.field)&&(d.icon===d.defaultIcon&&(d.icon=null),a=d.icon||d.defaultIcon,i=a,d.set("iconClass",i)),!t&&"name"!==e.field||""!==d.name||(d.name=null),(t||"name"===e.field||"defaultName"===e.field)&&(d.name===d.defaultName&&(d.name=null),d.displayName=d.name||d.defaultName||""),"category"===d.kind&&null==d.items&&(d.items=[])},m=function(t){var n,a,i,d,l;for(i=[],l=t.dataSource.data(),n=0,d=l.length;n<d;n++)a=l[n],a=a.toJSON(),i.push(a);e("#items").val(JSON.stringify(i)),e("#menuLeftHandForm").submit()},n=function(e){var t,a,i,d;if(delete e.iconClass,delete e.displayName,null!=e.items)for(d=e.items,a=0,i=d.length;a<i;a++)t=d[a],n(t);return e},g=function(e,t){var n;return n=r(e),null!=n||null!=t.defaultName?(t.set("name",n),t.set("icon",o(e)),!0):(s(e),!1)},a=function(e,n){var a,i;return i=r(e),null!=i?(a=new t({kind:"category",userItem:!0,name:i,icon:o(e)}),n.dataSource.add(a)):(s(e),!1)},s=function(e){var t;t=e.find(".item-name"),t.on("change keyup",c),t.tooltip({title:"You need to provide a name",placement:"bottom",trigger:"hover focus"}).focus()},c=function(){var t;t=e(this),""!==t.val()&&(t.tooltip("destroy"),t.off("change keyup",c))},r=function(e){var t,n;return t=e.find(".item-name"),null==t?null:(n=t.val(),""!==n?n:null)},o=function(e){return e.find(".item-icon").val()||null},l=function(e,t){var n,a,i;if(i=e.findByUid(t.uid),"undefined"!=typeof t.items)for(;t.items.length>0;)n=t.items[0],a=e.findByUid(n.uid),e.insertBefore(a,i);e.dataSource.remove(t)},h=function(e,t){var n,a,i,d,l;a=e.find(".item-default-name"),n=e.find(".item-default-icon"),i=e.find(".item-name"),i.tooltip("destroy"),d=e.find(".item-icon"),null!=t.uid?(e.removeClass("modal-for-new"),e.data("uid",t.uid),null!=t.defaultName?(a.text(t.defaultName),i.attr("placeholder",t.defaultName)):(a.html("<i>(No default name)</i>"),i.removeAttr("placeholder")),null!=t.icon?d.val(t.icon):(l=t.defaultIcon,l="item-default-icon "+l,d.attr("placeholder",t.defaultIcon)),n.attr("class",l),i.val(t.name||t.defaultName||""),d=t.icon||t.defaultIcon):(e.addClass("modal-for-new"),e.removeData("uid"),i.val(""),i.removeAttr("placeholder")),e.find(".item-defaults-group").toggleClass("hidden",t.userItem===!0),e.modal("show")},p=function(e,t){var n,a,i,d,l;e.data("uid",t.uid),a=e.find(".item-preview"),n=a.find(".fi"),i=t.icon||t.defaultIcon,d=i,n.attr("class",d),l=t.name||t.defaultName||"(Unnamed "+t.kind+")",a.find(".name").text(l),e.modal("show")},u=function(e){var t,n,a,i,d;if(a={kind:e.kind},null!=e.id&&(a.id=e.id),null!=e.name&&(a.name=e.name),null!=e.route&&(a.route=e.route),null!=e.linked_routes&&(a.linked_routes=e.linked_routes),null!=e.feature_id&&(a.feature_id=e.feature_id),null!=e.icon&&(a.icon=e.icon),e.userItem?a.userItem=!0:(null!=e.defaultName&&(a.defaultName=e.defaultName),null!=e.defaultIcon&&(a.defaultIcon=e.defaultIcon)),null!=e.items)for(a.items=[],d=e.items,n=0,i=d.length;n<i;n++)t=d[n],a.items.push(u(t));return a},t=kendo.data.Node.define({id:"id",children:"items",fields:{id:{type:"number",editable:!1,nullable:!0},kind:{type:"string",editable:!1},name:{type:"string",nullable:!0},defaultName:{type:"string",editable:!1},feature_id:{type:"number",editable:!1,nullable:!0},route:{type:"string",editable:!1,nullable:!0},linked_routes:{type:"string",editable:!1,nullable:!0},icon:{type:"string",nullable:!0},defaultIcon:{type:"string",editable:!1,nullable:!0},userItem:{type:"boolean",editable:!1,defaultValue:!1},displayName:{type:"string"},iconClass:{type:"string"}},toJSON:function(){return u(this)}}),e(function(){var n,o,r,u,s,c,f;s=e("#menu-left-hand-administration"),u=s.find(".modal-for-edit"),r=s.find(".modal-for-delete"),n=s.find(".modal-for-reset-defaults"),o=s.find(".modal-for-reset-saved"),s.data("current-json",s.data("json")),f=function(e){k=!!e,k?s.find(".action-save-tree").prop("disabled",!1):s.find(".action-save-tree").prop("disabled",!0)},window.onbeforeunload=function(){return k&&!S?"You have unsaved changes, are you sure you want to discard them?":void 0},c=s.find(".tree").kendoTreeView({template:kendo.template(s.find(".item-template").html()),dragAndDrop:!0,autoScroll:!0,drag:v,dragend:function(){f(!0)},dataTextField:"name",loadOnDemand:!1,dataSource:{data:s.data("current-json"),schema:{model:t},change:d},dataBound:i}).data("kendoTreeView"),c.templates.dragClue=kendo.template(s.find(".drag-clue-template").html()),s.find(".action-new-category").click(function(){h(u,{kind:"category",userItem:!0})}),s.find(".action-expand-all").click(function(){c.expand(".k-item")}),s.find(".action-collapse-all").click(function(){c.collapse(".k-item")}),s.find(".action-reset-defaults").click(function(){var t;t=e(this),t.prop("disabled",!0),n.modal("show")}),s.find(".action-reset-saved").click(function(){var t;t=e(this),t.prop("disabled",!0),o.modal("show")}),s.find(".action-save-tree").click(function(){S=!0,c.enable(".k-item",!1),m(c,s),f(!1)}),s.on("click",".item-category",function(){var t;return t=e(this).closest(".k-item"),"true"!==t.attr("aria-disabled")&&void c.toggle(t)}),s.on("click",".action-edit",function(){var t,n;return t=e(this).closest(".k-item"),"true"!==t.attr("aria-disabled")&&(n=c.dataItem(t),void h(u,n))}),u.on("shown.bs.modal",function(){u.find(".item-name").focus()}),u.find(".action-modal-save").click(function(){var t,n,i,d;t=e(this),t.prop("disabled",!0),d=u.data("uid"),null!=d?(n=c.dataSource.getByUid(d),i=g(u,n)):i=a(u,c),i&&(u.modal("hide"),f(!0)),t.prop("disabled",!1)}),u.find(".action-delete").click(function(){var e,t;t=u.data("uid"),e=c.dataSource.getByUid(t),p(r,e)}),r.find(".action-modal-delete").click(function(){var t,n,a;t=e(this),t.prop("disabled",!0),a=r.data("uid"),null!=a&&(n=c.dataSource.getByUid(a),l(c,n),f(!0)),r.modal("hide"),t.prop("disabled",!1)}),n.on("shown.bs.modal",function(){n.find(".action-modal-cancel").focus()}),n.find(".action-modal-reset-defaults").click(function(){var t;t=e(this),s.data("current-json",s.data("defaults-json")),c.dataSource.data(s.data("current-json")),n.modal("hide"),t.prop("disabled",!1),f(!0)}),o.on("shown.bs.modal",function(){o.find(".action-modal-cancel").focus()}),o.find(".action-modal-reset-saved").click(function(){var t;t=e(this),s.data("current-json",s.data("json")),c.dataSource.data(s.data("current-json")),o.modal("hide"),t.prop("disabled",!1),f(!1)})})}).call(this);